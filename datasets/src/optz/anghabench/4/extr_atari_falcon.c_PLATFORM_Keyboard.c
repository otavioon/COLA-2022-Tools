#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int UBYTE ;
struct TYPE_2__ {scalar_t__ unshift; scalar_t__ shift; } ;

/* Variables and functions */
 int AKEY_0 ; 
 int AKEY_1 ; 
 int AKEY_2 ; 
 int AKEY_3 ; 
 int AKEY_4 ; 
 int AKEY_5 ; 
 int AKEY_6 ; 
 int AKEY_7 ; 
 int AKEY_8 ; 
 int AKEY_9 ; 
 int AKEY_A ; 
 int AKEY_AMPERSAND ; 
 int AKEY_ASTERISK ; 
 int AKEY_AT ; 
 int AKEY_B ; 
 int AKEY_BACKSLASH ; 
 int AKEY_BACKSPACE ; 
 int AKEY_BAR ; 
 int AKEY_BRACKETLEFT ; 
 int AKEY_BRACKETRIGHT ; 
 int AKEY_BREAK ; 
 int AKEY_C ; 
 int AKEY_CAPSTOGGLE ; 
 int AKEY_CIRCUMFLEX ; 
 int AKEY_CLRTAB ; 
 int AKEY_COLDSTART ; 
 int AKEY_COLON ; 
 int AKEY_COMMA ; 
 int AKEY_CTRL_a ; 
 int AKEY_CTRL_b ; 
 int AKEY_CTRL_c ; 
 int AKEY_CTRL_d ; 
 int AKEY_CTRL_e ; 
 int AKEY_CTRL_f ; 
 int AKEY_CTRL_g ; 
 int AKEY_CTRL_h ; 
 int AKEY_CTRL_i ; 
 int AKEY_CTRL_j ; 
 int AKEY_CTRL_k ; 
 int AKEY_CTRL_l ; 
 int AKEY_CTRL_m ; 
 int AKEY_CTRL_n ; 
 int AKEY_CTRL_o ; 
 int AKEY_CTRL_p ; 
 int AKEY_CTRL_q ; 
 int AKEY_CTRL_r ; 
 int AKEY_CTRL_s ; 
 int AKEY_CTRL_t ; 
 int AKEY_CTRL_u ; 
 int AKEY_CTRL_v ; 
 int AKEY_CTRL_w ; 
 int AKEY_CTRL_x ; 
 int AKEY_CTRL_y ; 
 int AKEY_CTRL_z ; 
 int AKEY_D ; 
 int AKEY_DBLQUOTE ; 
 int AKEY_DOLLAR ; 
 int AKEY_DOWN ; 
 int AKEY_E ; 
 int AKEY_EQUAL ; 
 int AKEY_ESCAPE ; 
 int AKEY_EXCLAMATION ; 
 int AKEY_EXIT ; 
 int AKEY_F ; 
 int AKEY_FULLSTOP ; 
 int AKEY_G ; 
 int AKEY_GREATER ; 
 int AKEY_H ; 
 int AKEY_HASH ; 
 int AKEY_HELP ; 
 int AKEY_I ; 
 int AKEY_J ; 
 int AKEY_K ; 
 int AKEY_L ; 
 int AKEY_LEFT ; 
 int AKEY_LESS ; 
 int AKEY_M ; 
 int AKEY_MINUS ; 
 int AKEY_N ; 
 int AKEY_NONE ; 
 int AKEY_O ; 
 int AKEY_P ; 
 int AKEY_PARENLEFT ; 
 int AKEY_PARENRIGHT ; 
 int AKEY_PERCENT ; 
 int AKEY_PLUS ; 
 int AKEY_Q ; 
 int AKEY_QUESTION ; 
 int AKEY_QUOTE ; 
 int AKEY_R ; 
 int AKEY_RETURN ; 
 int AKEY_RIGHT ; 
 int AKEY_S ; 
 int AKEY_SCREENSHOT ; 
 int AKEY_SCREENSHOT_INTERLACE ; 
 int AKEY_SEMICOLON ; 
 int AKEY_SETTAB ; 
 int AKEY_SLASH ; 
 int AKEY_SPACE ; 
 int AKEY_T ; 
 int AKEY_TAB ; 
 int AKEY_U ; 
 int AKEY_UI ; 
 int AKEY_UNDERSCORE ; 
 int AKEY_UP ; 
 int AKEY_V ; 
 int AKEY_W ; 
 int AKEY_WARMSTART ; 
 int AKEY_X ; 
 int AKEY_Y ; 
 int AKEY_Z ; 
 int AKEY_a ; 
 int AKEY_b ; 
 int AKEY_c ; 
 int AKEY_d ; 
 int AKEY_e ; 
 int AKEY_f ; 
 int AKEY_g ; 
 int AKEY_h ; 
 int AKEY_i ; 
 int AKEY_j ; 
 int AKEY_k ; 
 int AKEY_l ; 
 int AKEY_m ; 
 int AKEY_n ; 
 int AKEY_o ; 
 int AKEY_p ; 
 int AKEY_q ; 
 int AKEY_r ; 
 int AKEY_s ; 
 int AKEY_t ; 
 int AKEY_u ; 
 int AKEY_v ; 
 int AKEY_w ; 
 int AKEY_x ; 
 int AKEY_y ; 
 int AKEY_z ; 
 int /*<<< orphan*/  INPUT_CONSOL_OPTION ; 
 int /*<<< orphan*/  INPUT_CONSOL_SELECT ; 
 int /*<<< orphan*/  INPUT_CONSOL_START ; 
 scalar_t__ INPUT_STICK_BACK ; 
 scalar_t__ INPUT_STICK_CENTRE ; 
 scalar_t__ INPUT_STICK_FORWARD ; 
 scalar_t__ INPUT_STICK_LEFT ; 
 scalar_t__ INPUT_STICK_RIGHT ; 
 int /*<<< orphan*/  INPUT_key_consol ; 
 int /*<<< orphan*/  PLATFORM_Exit (int) ; 
 int SCANCODE_A ; 
 int SCANCODE_C ; 
 int SCANCODE_D ; 
 int SCANCODE_L ; 
 int SCANCODE_O ; 
 int SCANCODE_R ; 
 int SCANCODE_S ; 
 int SCANCODE_T ; 
 int SCANCODE_Y ; 
 int UI_MENU_ABOUT ; 
 int UI_MENU_CARTRIDGE ; 
 int UI_MENU_CASSETTE ; 
 int UI_MENU_DISK ; 
 int UI_MENU_LOADSTATE ; 
 int UI_MENU_RUN ; 
 int UI_MENU_SAVESTATE ; 
 int UI_MENU_SOUND ; 
 int UI_MENU_SYSTEM ; 
 int UI_alt_function ; 
 int* key_buf ; 
 TYPE_1__* key_tab ; 
 scalar_t__ stick0 ; 
 int trig0 ; 

int PLATFORM_Keyboard(void)
{
	UBYTE shift_key, control_key;
	int scancode, keycode;
	int i;

	trig0 = 1;
	stick0 = INPUT_STICK_CENTRE;

	shift_key = (key_buf[0x2a] || key_buf[0x36]);
	control_key = key_buf[0x1d];

	if (!shift_key && !control_key) {
		if (key_buf[0x70])
			trig0 = 0;
		if (key_buf[0x6d] || key_buf[0x6e] || key_buf[0x6f])
			stick0 -= (INPUT_STICK_CENTRE - INPUT_STICK_BACK);
		if (key_buf[0x6f] || key_buf[0x6c] || key_buf[0x69])
			stick0 -= (INPUT_STICK_CENTRE - INPUT_STICK_RIGHT);
		if (key_buf[0x6d] || key_buf[0x6a] || key_buf[0x67])
			stick0 -= (INPUT_STICK_CENTRE - INPUT_STICK_LEFT);
		if (key_buf[0x67] || key_buf[0x68] || key_buf[0x69])
			stick0 -= (INPUT_STICK_CENTRE - INPUT_STICK_FORWARD);
	}

	scancode = 0;

	if (stick0 == INPUT_STICK_CENTRE && trig0 == 1) {
		for (i = 1; i <= 0x72; i++)	{	/* search for pressed key */
			if (key_buf[i]) {
				if (i == 0x1d || i == 0x2a || i == 0x36		/* Shift, Control skip */
					|| i == 0x3c || i == 0x3d || i == 0x3e)	/* F2, F3, F4 skip */
					continue;
				scancode = i;
				break;
			}
		}
	}

#define SCANCODE_TAB	0x0f
#define SCANCODE_CONTROL	0x1d
#define SCANCODE_LSHIFT		0x2a
#define SCANCODE_RSHIFT		0x36
#define SCANCODE_ALT		0x38

#define SCANCODE_R			0x13
#define SCANCODE_Y			0x2c
#define SCANCODE_O			0x18
#define SCANCODE_A			0x1e
#define SCANCODE_S			0x1f
#define SCANCODE_D			0x20
#define SCANCODE_L			0x26
#define SCANCODE_C			0x2e
#define SCANCODE_T			0x14

	UI_alt_function = -1;		/* no alt function */
	if (key_buf[0x38]) {		/* left Alt key is pressed */
		if (scancode == SCANCODE_R)
			UI_alt_function = UI_MENU_RUN;		/* ALT+R .. Run file */
		else if (scancode == SCANCODE_Y)
			UI_alt_function = UI_MENU_SYSTEM;		/* ALT+Y .. Select system */
		else if (scancode == SCANCODE_O)
			UI_alt_function = UI_MENU_SOUND;		/* ALT+O .. mono/stereo sound */
		else if (scancode == SCANCODE_A)
			UI_alt_function = UI_MENU_ABOUT;		/* ALT+A .. About */
		else if (scancode == SCANCODE_S)
			UI_alt_function = UI_MENU_SAVESTATE;	/* ALT+S .. Save state */
		else if (scancode == SCANCODE_D)
			UI_alt_function = UI_MENU_DISK;		/* ALT+D .. Disk management */
		else if (scancode == SCANCODE_L)
			UI_alt_function = UI_MENU_LOADSTATE;	/* ALT+L .. Load state */
		else if (scancode == SCANCODE_C)
			UI_alt_function = UI_MENU_CARTRIDGE;	/* ALT+C .. Cartridge management */
		else if (scancode == SCANCODE_T)
			UI_alt_function = UI_MENU_CASSETTE;	/* ALT+T .. Tape management */
	}
		if (UI_alt_function != -1)
			return AKEY_UI;


	if (key_buf[0x3c])	/* F2 */
		INPUT_key_consol &= ~INPUT_CONSOL_OPTION;	/* OPTION key ON */
	else
		INPUT_key_consol |= INPUT_CONSOL_OPTION;	/* OPTION key OFF */
	if (key_buf[0x3d])	/* F3 */
		INPUT_key_consol &= ~INPUT_CONSOL_SELECT;	/* SELECT key ON */
	else
		INPUT_key_consol |= INPUT_CONSOL_SELECT;	/* SELECT key OFF */
	if (key_buf[0x3e])	/* F4 */
		INPUT_key_consol &= ~INPUT_CONSOL_START;	/* START key ON */
	else
		INPUT_key_consol |= INPUT_CONSOL_START;	/* START key OFF */

	if (scancode) {
		/* read ASCII code of pressed key */
		if (shift_key)
			keycode = *(UBYTE *) (key_tab->shift + scancode);
		else
			keycode = *(UBYTE *) (key_tab->unshift + scancode);

		if (control_key)
			keycode -= 64;

		switch (keycode) {
		case 0x01:
			keycode = AKEY_CTRL_a;
			break;
		case 0x02:
			keycode = AKEY_CTRL_b;
			break;
		case 0x03:
			keycode = AKEY_CTRL_c;
			break;
		case 0x04:
			keycode = AKEY_CTRL_d;
			break;
		case 0x05:
			keycode = AKEY_CTRL_e;
			break;
		case 0x06:
			keycode = AKEY_CTRL_f;
			break;
		case 0x07:
			keycode = AKEY_CTRL_g;
			break;
		case 0x08:
			if (scancode == 0x0e)
				keycode = AKEY_BACKSPACE;
			else
				keycode = AKEY_CTRL_h;
			break;
		case 0x09:
			if (scancode == 0x0f) {
				if (shift_key)
					keycode = AKEY_SETTAB;
				else if (control_key)
					keycode = AKEY_CLRTAB;
				else
					keycode = AKEY_TAB;
			}
			else
				keycode = AKEY_CTRL_i;
			break;
		case 0x0a:
			keycode = AKEY_CTRL_j;
			break;
		case 0x0b:
			keycode = AKEY_CTRL_k;
			break;
		case 0x0c:
			keycode = AKEY_CTRL_l;
			break;
		case 0x0d:
			if (scancode == 0x1c || scancode == 0x72)
				keycode = AKEY_RETURN;
			else
				keycode = AKEY_CTRL_m;
			break;
		case 0x0e:
			keycode = AKEY_CTRL_n;
			break;
		case 0x0f:
			keycode = AKEY_CTRL_o;
			break;
		case 0x10:
			keycode = AKEY_CTRL_p;
			break;
		case 0x11:
			keycode = AKEY_CTRL_q;
			break;
		case 0x12:
			keycode = AKEY_CTRL_r;
			break;
		case 0x13:
			keycode = AKEY_CTRL_s;
			break;
		case 0x14:
			keycode = AKEY_CTRL_t;
			break;
		case 0x15:
			keycode = AKEY_CTRL_u;
			break;
		case 0x16:
			keycode = AKEY_CTRL_v;
			break;
		case 0x17:
			keycode = AKEY_CTRL_w;
			break;
		case 0x18:
			keycode = AKEY_CTRL_x;
			break;
		case 0x19:
			keycode = AKEY_CTRL_y;
			break;
		case 0x1a:
			keycode = AKEY_CTRL_z;
			break;
		case ' ':
			keycode = AKEY_SPACE;
			break;
		case '`':
			keycode = AKEY_CAPSTOGGLE;
			break;
		case '!':
			keycode = AKEY_EXCLAMATION;
			break;
		case '"':
			keycode = AKEY_DBLQUOTE;
			break;
		case '#':
			keycode = AKEY_HASH;
			break;
		case '$':
			keycode = AKEY_DOLLAR;
			break;
		case '%':
			keycode = AKEY_PERCENT;
			break;
		case '&':
			keycode = AKEY_AMPERSAND;
			break;
		case '\'':
			keycode = AKEY_QUOTE;
			break;
		case '@':
			keycode = AKEY_AT;
			break;
		case '(':
			keycode = AKEY_PARENLEFT;
			break;
		case ')':
			keycode = AKEY_PARENRIGHT;
			break;
		case '[':
			keycode = AKEY_BRACKETLEFT;
			break;
		case ']':
			keycode = AKEY_BRACKETRIGHT;
			break;
		case '<':
			keycode = AKEY_LESS;
			break;
		case '>':
			keycode = AKEY_GREATER;
			break;
		case '=':
			keycode = AKEY_EQUAL;
			break;
		case '?':
			keycode = AKEY_QUESTION;
			break;
		case '-':
			keycode = AKEY_MINUS;
			break;
		case '+':
			keycode = AKEY_PLUS;
			break;
		case '*':
			keycode = AKEY_ASTERISK;
			break;
		case '/':
			keycode = AKEY_SLASH;
			break;
		case ':':
			keycode = AKEY_COLON;
			break;
		case ';':
			keycode = AKEY_SEMICOLON;
			break;
		case ',':
			keycode = AKEY_COMMA;
			break;
		case '.':
			keycode = AKEY_FULLSTOP;
			break;
		case '_':
			keycode = AKEY_UNDERSCORE;
			break;
		case '^':
			keycode = AKEY_CIRCUMFLEX;
			break;
		case '\\':
			keycode = AKEY_BACKSLASH;
			break;
		case '|':
			keycode = AKEY_BAR;
			break;
		case '0':
			keycode = AKEY_0;
			break;
		case '1':
			keycode = AKEY_1;
			break;
		case '2':
			keycode = AKEY_2;
			break;
		case '3':
			keycode = AKEY_3;
			break;
		case '4':
			keycode = AKEY_4;
			break;
		case '5':
			keycode = AKEY_5;
			break;
		case '6':
			keycode = AKEY_6;
			break;
		case '7':
			keycode = AKEY_7;
			break;
		case '8':
			keycode = AKEY_8;
			break;
		case '9':
			keycode = AKEY_9;
			break;
		case 'a':
			keycode = AKEY_a;
			break;
		case 'b':
			keycode = AKEY_b;
			break;
		case 'c':
			keycode = AKEY_c;
			break;
		case 'd':
			keycode = AKEY_d;
			break;
		case 'e':
			keycode = AKEY_e;
			break;
		case 'f':
			keycode = AKEY_f;
			break;
		case 'g':
			keycode = AKEY_g;
			break;
		case 'h':
			keycode = AKEY_h;
			break;
		case 'i':
			keycode = AKEY_i;
			break;
		case 'j':
			keycode = AKEY_j;
			break;
		case 'k':
			keycode = AKEY_k;
			break;
		case 'l':
			keycode = AKEY_l;
			break;
		case 'm':
			keycode = AKEY_m;
			break;
		case 'n':
			keycode = AKEY_n;
			break;
		case 'o':
			keycode = AKEY_o;
			break;
		case 'p':
			keycode = AKEY_p;
			break;
		case 'q':
			keycode = AKEY_q;
			break;
		case 'r':
			keycode = AKEY_r;
			break;
		case 's':
			keycode = AKEY_s;
			break;
		case 't':
			keycode = AKEY_t;
			break;
		case 'u':
			keycode = AKEY_u;
			break;
		case 'v':
			keycode = AKEY_v;
			break;
		case 'w':
			keycode = AKEY_w;
			break;
		case 'x':
			keycode = AKEY_x;
			break;
		case 'y':
			keycode = AKEY_y;
			break;
		case 'z':
			keycode = AKEY_z;
			break;
		case 'A':
			keycode = AKEY_A;
			break;
		case 'B':
			keycode = AKEY_B;
			break;
		case 'C':
			keycode = AKEY_C;
			break;
		case 'D':
			keycode = AKEY_D;
			break;
		case 'E':
			keycode = AKEY_E;
			break;
		case 'F':
			keycode = AKEY_F;
			break;
		case 'G':
			keycode = AKEY_G;
			break;
		case 'H':
			keycode = AKEY_H;
			break;
		case 'I':
			keycode = AKEY_I;
			break;
		case 'J':
			keycode = AKEY_J;
			break;
		case 'K':
			keycode = AKEY_K;
			break;
		case 'L':
			keycode = AKEY_L;
			break;
		case 'M':
			keycode = AKEY_M;
			break;
		case 'N':
			keycode = AKEY_N;
			break;
		case 'O':
			keycode = AKEY_O;
			break;
		case 'P':
			keycode = AKEY_P;
			break;
		case 'Q':
			keycode = AKEY_Q;
			break;
		case 'R':
			keycode = AKEY_R;
			break;
		case 'S':
			keycode = AKEY_S;
			break;
		case 'T':
			keycode = AKEY_T;
			break;
		case 'U':
			keycode = AKEY_U;
			break;
		case 'V':
			keycode = AKEY_V;
			break;
		case 'W':
			keycode = AKEY_W;
			break;
		case 'X':
			keycode = AKEY_X;
			break;
		case 'Y':
			keycode = AKEY_Y;
			break;
		case 'Z':
			keycode = AKEY_Z;
			break;
		case 0x1b:
			keycode = AKEY_ESCAPE;
			break;
		case 0x00:
			switch (scancode) {
			case 0x3b:			/* F1 */
			case 0x61:			/* Undo */
				keycode = AKEY_UI;
				break;
			case 0x62:			/* Help */
				keycode = AKEY_HELP;
				break;
			case 0x3f:			/* F5 */
				keycode = shift_key ? AKEY_COLDSTART : AKEY_WARMSTART;
				break;
			case 0x40:			/* F6 */
				keycode = AKEY_HELP;
				break;
			case 0x41:			/* F7 */
				keycode = AKEY_BREAK;
				break;
			case 0x42:			/* F8 */
				keycode = PLATFORM_Exit(1) ? AKEY_NONE : AKEY_EXIT;	/* invoke monitor */
				break;
			case 0x43:			/* F9 */
				keycode = AKEY_EXIT;
				break;
			case 0x44:			/* F10*/
				keycode = shift_key ? AKEY_SCREENSHOT_INTERLACE : AKEY_SCREENSHOT;
				break;
			case 0x50:
				keycode = AKEY_DOWN;
				break;
			case 0x4b:
				keycode = AKEY_LEFT;
				break;
			case 0x4d:
				keycode = AKEY_RIGHT;
				break;
			case 0x48:
				keycode = AKEY_UP;
				break;
			default:
				keycode = AKEY_NONE;
				break;
			}
			break;
		default:
			keycode = AKEY_NONE;
			break;
		}
	}
	else
		keycode = AKEY_NONE;

	// KEYPRESSED = (keycode != AKEY_NONE);

	return keycode;
}